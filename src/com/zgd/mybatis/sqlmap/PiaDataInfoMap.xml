<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">  
  
<mapper namespace="com.zgd.mybatis.dao.PiaDataInfoMapper">  
  
<select id="getPiaDataInfoList" parameterType="PraInfo" resultType="PiaDataInfo">
	SELECT
		playDate,
		taiNo,
		rate,
		bonusCount,
		ballOutput,
		totalOut,
		rateN,
		bonusCountN,
		ballOutputN,
		playDateN,
		totalOutN
	FROM
		v_satama_by_d_t
	WHERE
		taiNo = #{taiNo}
	<if test="playDate != null and playDate > 0">
		AND playDate = #{playDate}
	</if>
	ORDER BY playDate ASC;

</select>  

<select id="getPiaBallsOfDay" parameterType="PraInfo" resultType="PiaDataInfo">
	SELECT
		v.playDate,
		v.taiNo,
		v.rate,
		v.bonusCount,
		v.ballOutput,
		v.totalOut,
		v.rateN,
		v.bonusCountN,
		v.ballOutputN,
		v.playDateN,
		v.totalOutN,
        b.rate as rate1,
        b.ballOutput as ballOutput1,
        c.rate as rate2,
        c.ballOutput as ballOutput2,
        d.rate as rate3,
        d.ballOutput as ballOutput3
	FROM
		v_satama_by_d_t v
		LEFT OUTER JOIN piainfo b
		on (b.taino = v.taino and b.playDate = adddays(v.playDate,1))
        LEFT OUTER JOIN piainfo c
		on (c.taino = v.taino and c.playDate = adddays(v.playDate,2))
         LEFT OUTER JOIN piainfo d
		on (d.taino = v.taino and d.playDate = adddays(v.playDate,3))
	WHERE
		v.playDate = #{playDate}
	ORDER BY totalOut DESC;

</select> 

<select id="getPiaDataByDate" parameterType="PraInfo" resultType="PiaDataInfo">
	SELECT
		v.playDate,
		v.taiNo,
		v.rate,
		v.bonusCount,
		v.ballOutput,
		v.totalOut,
		v.totalOutBefore,
		v.rateN,
		v.bonusCountN,
		v.ballOutputN,
		v.playDateN,
		v.totalOutN,
        b.rate as rate1,
        b.ballOutput as ballOutput1,
        c.rate as rate2,
        c.ballOutput as ballOutput2,
        d.rate as rate3,
        d.ballOutput as ballOutput3
	FROM
		v_satama_by_d_t v
		LEFT OUTER JOIN piainfo b
		on (b.taino = v.taino and b.playDate = adddays(v.playDate,-1))
        LEFT OUTER JOIN piainfo c
		on (c.taino = v.taino and c.playDate = adddays(v.playDate,-2))
         LEFT OUTER JOIN piainfo d
		on (d.taino = v.taino and d.playDate = adddays(v.playDate,-3))
	WHERE
		v.playDate = #{playDate}
	<if test="sortKind == 'ballOutput'">
		ORDER BY ballOutput DESC;
	</if>
	<if test="sortKind == 'totalOutBefore'">
		ORDER BY totalOutBefore DESC;
	</if>
	<if test="sortKind == 'totalOut'">
		ORDER BY totalOut DESC;
	</if>
	<if test="sortKind == 'rate'">
		ORDER BY rate1 DESC;
	</if>
</select> 

<insert id="insertPiaDataInfo" parameterType="PiaDataInfo">
	INSERT INTO 
		piainfo(playDate,taiNo,rate,bonusCount,ballOutput)
	VALUES(#{playDate},#{taiNo},#{rate},#{bonusCount},#{ballOutput})
</insert>
<update id="updatePiaDataInfo" parameterType="PiaDataInfo" >
	UPDATE
		piainfo
	SET
		rate = #{rate},
		bonusCount = #{bonusCount},
		ballOutput = #{ballOutput}
	WHERE
		playDate = #{playDate}
	AND
		taiNo = #{taiNo}
</update>
<delete id="deletePiaDataInfo" parameterType="PiaDataInfo" >
  DELETE FROM piainfo 
  WHERE
  	playDate = #{playDate}
  AND
  	taiNo = #{taiNo}
</delete>
</mapper>